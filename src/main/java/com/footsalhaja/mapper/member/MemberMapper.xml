<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
 <mapper namespace="com.footsalhaja.mapper.member.MemberMapper">
	<!-- 회원정보 저장 -->
	<insert id="insertMember">
		INSERT INTO member 
			(  userId,   name,    password,    nickName,    email,    birthYY,    birthMM,    birthDD,    activityArea,    phone,     personalGender  )
		VALUES
			(#{userId}, #{name}, #{password}, #{nickName}, #{email}, #{birthYY}, #{birthMM}, #{birthDD}, #{activityArea}, #{phone},  #{personalGender} )
	</insert>
 	
 	
 	<update id="updateMemberInfoByUserId">
 		UPDATE member
 		SET 	 		
	 		password = #{password},
	 		nickName = #{nickName},
	 		email = #{email},
	 		phone = #{phone}
	 	WHERE
	 		userId = #{userId}	 			 		
 	</update>
 	<select id="selectAllMemberCount" resultType="int">
	 	SELECT COUNT(*)
	 	FROM member
	 	WHERE
		<trim prefixOverrides="OR">
			<if test="type == 'all' or type == 'userId'">
 			OR userId LIKE #{keyword}
			</if>
			<if test="type == 'all' or type == 'name'">
 			OR name LIKE #{keyword}
			</if>
		</trim>
 	</select>
 	
 	<!-- 모든 회원정보 List로 가져오기 , 페이지네이션 & 검색 기능 추가 -->
 	<select id="selectMemberList" resultMap="memberListMap">
 	SELECT 
 		userId,
 		name,
 		password,
 		nickName,
 		email,
 		birthYY,
 		birthMM,
 		birthDD,
 		activityArea,
 		phone,
 		personalGender,
 		auth
 	FROM
 		member
 	WHERE
 		<trim prefixOverrides="OR">
 			<if test="type == 'all' or type == 'userId'">
 			OR userId LIKE #{keyword}
 			</if>
 			<if test="type == 'all' or type == 'name'">
 			OR name LIKE #{keyword}
 			</if>
 		</trim>
 	ORDER BY name
 	LIMIT #{offset}, #{records}
 	</select>
 	<resultMap type="com.footsalhaja.domain.member.MemberDto" id="memberListMap">
 		<id column="userId" property="userId" />
 		<result column="name" property="name" />
 		<result column="password" property="password" />
 		<result column="nickName" property="nickName" />
 		<result column="email" property="email" />
 		<result column="birthYY" property="birthYY" />
 		<result column="birthMM" property="birthMM" />
 		<result column="birthDD" property="birthDD" />
 		<result column="activityArea" property="activityArea" />
 		<result column="phone" property="phone" />
 		<result column="personalGender" property="personalGender" />
 		<collection ofType="string" property="auth">
 			<result column="auth" property="auth"/>
 		</collection>
 	</resultMap>
 	
 	<!-- userId 로 하나의 회원정보 가져오기 -->
 	<select id="selectMemberInfoByUserId" resultMap="memberMap">
	SELECT 
		userId,
		name,
		password,
		nickName,
		email,
		birthYY,
		birthMM,
		birthDD,
		activityArea,
		phone,
		personalGender,
		auth
	FROM
		member
	WHERE
		userId = #{userId}
	</select>
	<resultMap type="com.footsalhaja.domain.member.MemberDto" id="memberMap">
 		<id column="userId" property="userId" />
 		<result column="name" property="name" />
 		<result column="password" property="password" />
 		<result column="nickName" property="nickName" />
 		<result column="email" property="email" />
 		<result column="birthYY" property="birthYY" />
 		<result column="birthMM" property="birthMM" />
 		<result column="birthDD" property="birthDD" />
 		<result column="activityArea" property="activityArea" />
 		<result column="phone" property="phone" />
 		<result column="personalGender" property="personalGender" />
 		<collection ofType="string" property="auth">
 			<result column="auth" property="auth"/>
 		</collection>
 	</resultMap>
	
 	<!-- 회원탈퇴 member ByUserId -->
 	<delete id="deleteMemberInfoByUserId">
	 	DELETE FROM member
	 	WHERE userId = #{userId}
 	</delete>
 	<!-- 회원탈퇴 FK Authority ByUserId -->
 	<delete id="deleteAuthorityByUserId">
 		DELETE FROM authority
	 	WHERE userId = #{userId}
 	</delete>
 	
 	<!-- 내글 보기(아카데미 게시판) -->
 	<select id="getUserAbList" resultMap="userAbMap">
	 	SELECT
		 	m.userId,
			m.nickName,
	        a.ab_number,
	        a.ab_category,
	        a.ab_title,
	        a.ab_insertDatetime,
	        a.ab_viewCount
		FROM member m LEFT JOIN academyBoard a ON m.userId = a.member_userId
	    WHERE m.userId = #{userId}
	    ORDER BY a.ab_number DESC
 	
 	</select>
 	
 	<resultMap type="com.footsalhaja.domain.member.MemberDto" id="userAbMap">
 		<id column="userId" property="userId"></id>
 		<result column="nickName" property="nickName" />
 		<collection property="userAbList" resultMap="userAbList"></collection>
 	</resultMap>
 	
 	<resultMap type="com.footsalhaja.domain.academy.BoardDto" id="userAbList">
 		<result column="ab_number" property="ab_number" />
		<result column="ab_category" property="ab_category"/>
 		<result column="ab_title" property="ab_title"/>
		<result column="ab_insertDatetime" property="ab_insertDatetime"/>
		<result column="ab_viewCount" property="ab_viewCount"/>
 	</resultMap>
 </mapper>